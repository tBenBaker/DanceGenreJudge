<!--
    * TODO: Detect if user is on phone
    * TODO: Fix phone layout
 -->

 <!DOCTYPE html>
 <html lang="en">
     <head>
         <meta charset="UTF-8" />
         <meta http-equiv="X-UA-Compatible" content="IE=edge" />
         <meta name="viewport" content="width=device-width, initial-scale=1.0" />
         <title>Genre Guessing</title>
 
         <!-- The JsPsych library itself -->
         <link href="https://unpkg.com/jspsych@7.3.1/css/jspsych.css" rel="stylesheet" type="text/css" />
 
         <!-- JsPsych Plugins to handle different "slides" in the experiment slideshow -->
         <script src="https://unpkg.com/jspsych@7.3.1"></script>
         <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.2"></script>
         <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.2"></script>
         <script src="https://unpkg.com/@jspsych/plugin-survey-likert@1.1.2"></script>
         <script src="https://cdn.jsdelivr.net/gh/datatops/datatops.js@v0.1.2/datatops.js"></script>
 
         <!-- A list of all of the videos to choose from -->
         <script src="manifest.js"></script>
     </head>
     <body>
         <script>
             // Instantiate the JsPsych object. Here, we also supply a function
             // to run when the experiment is finished.
             const jsPsych = initJsPsych({});
 
             // How many videos to show the user. (Doesn't include the "intro" slide.)
             const N_TRIALS = 16;
 
             const LIKERT_WIDTH = 350;
 
             // The list of videos to show the user.
             // We use the manifest to get a list of all the videos, then
             // randomly select N_TRIALS of them.
             const nVideos = jsPsych.randomization.sampleWithoutReplacement(manifest.videos, N_TRIALS);
 
             // Add some properties to the data saved at the end of the exp.
             // Here we generate a random ID for the user.
             jsPsych.data.addProperties({
                 subject: jsPsych.randomization.randomID(15),
             });
 
             // The timeline contains the "slides" of the experiment.
             let timeline = [
                 // The first slide is an intro slide.
                 {
                     type: jsPsychHtmlButtonResponse,
                     choices: ["Next"],
                     stimulus: "Welcome to this dance science experiment! <br /> <br /> You will be asked a few questions about your dance background, then asked to guess the genre of some short dance clips. <br /> <br /> If you would like to participate, press the button below.",
                 },
 
                 {
                     type: jsPsychSurveyLikert,
                     scale_width: LIKERT_WIDTH,
                     questions: [
                         {
                             prompt: "Are you a dancer?",
                             labels: ["No", "Rarely", "Sometimes", "Often", "Professional"],
                             required: true,
                         },
                     ],
                 },
                 {
                     type: jsPsychSurveyLikert,
                     scale_width: LIKERT_WIDTH,
                     questions: [
                         {
                             prompt: "Are you a hip-hop dancer?",
                             labels: ["No", "Rarely", "Sometimes", "Often", "Professional"],
                             required: true,
                         },
                     ],
                 },
                 {
                     type: jsPsychSurveyLikert,
                     scale_width: LIKERT_WIDTH,
                     questions: [
                         {
                             prompt: "Do you watch hip-hop dance?",
                             labels: ["No", "Rarely", "Sometimes", "Often", "Professional"],
                             required: true,
                         },
                     ],
                 },
 
                 // Finally, we show an introduction to the task.
                 {
                     type: jsPsychHtmlButtonResponse,
                     stimulus: `
                     Next, please give your responses to a series of a short dance clips. Each has three views of the same dancer, and looks like <b>this:</b><br />
                     <video
                         autoplay
                         loop
                         muted
                     >
                         <source
                             src="videos/gBR_sBM_cAll_d04_mBR0_ch02.mp4"
                             type="video/mp4"
                         >
                     </video>
                     <br />
                     Your task is to guess which of the ten listed genres the dance is from. <br />
                     <br />
                     This example is from breakdancing. Click "Break" to continue to the experiment.
                     `,
 
                     choices: jsPsych.randomization.shuffle(manifest.genres.map((i) => i.name)),
                     correct_choice: "Break",
                 },
             ];
 
             timeline.push(
                 ...nVideos.map((video) => {
                     let genreOrdering = jsPsych.randomization.shuffle(manifest.genres.map((i) => i.name));
 
                     return {
                         type: jsPsychHtmlButtonResponse,
                         data: {
                             video,
                             genreButtons: genreOrdering,
                         },
                         stimulus: `
                     What genre is this clip?<br />
                     <video
                         autoplay
                         loop
                         muted
                     >
                         <source
                             src="${video.path}"
                             type="video/mp4"
                         >
                     </video>
                         `,
                         choices: genreOrdering,
                     };
                 })
             );
 
             // Add an on-finish to the last datapoint:
             timeline[timeline.length - 1].on_finish = function () {
                 // Send the data to the server
                 const data = jsPsych.data.get().values();
                 new Datatops({
                     server: "https://pmyvdlilci.execute-api.us-east-1.amazonaws.com/klab",
                     userKey: "pygwwd9t",
                     project: "dancegenre",
                 }).store({ submittedDate: new Date(), responses: data });
             };
 
             timeline.push({
                 type: jsPsychHtmlKeyboardResponse,
                 stimulus: "Thanks! And thanks to AIST++ for the open dance dataset!",
             });
 
             jsPsych.run(timeline);
         </script>
     </body>
 </html>